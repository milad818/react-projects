<!DOCTYPE html>
<html>
  <head>
    <title>Chatbot</title>
    <style>

      body {
        font-family: Arial;
      }

      .send-button {
        background-color: rgb(7, 133, 74);
        color: white;
        padding: 12px 20px;
        margin-left: 6px;
        border: none;
        border-radius: 11px;
        font-size: 14px;
        cursor:pointer
      }

      .chat-input {
        padding: 11px 20px;
        border-radius: 11px;
        border-width: 1px;
        font-size: 15px;

        flex-grow: 1;
      }

      .chat-input-container {
        display: flex;
      }

      .app-container {
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }

      .chat-message-user {
        display: flex;
        justify-content: end;
        align-items: start;
      }

      .chat-message-robot {
        display: flex;
        align-items: start;
      }

      .chat-message-text {
        background-color: rgb(233, 232, 230);
        padding: 15px 20px;
        border-radius: 10px;
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 10px;
        margin-top: 10px;
        max-width: 300px;
      }

      .chat-message-image {
        width: 45px;
      }
    </style>

  </head>
  <body>
    <div class="js-container"></div>

    <script src="react-basics.js"></script>
    <script src="https://unpkg.com/supersimpledev/external-library.js"></script>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">
        // Babel will convert JSX to regular JavaScript so browsers can understand it
        // Your JSX code goes here

        function ChatInput( {chatMessages, setChatMessages} ) {

          const [inputText, setInputText] = React.useState('');

          function saveInputText(event) {
            setInputText(event.target.value);
          }

          function sendMessage() {
            
            const newChatMessages = [
              ...chatMessages,
              {
                message: inputText,
                sender: 'user',
                id: crypto.randomUUID()
              }
            ]
            
            // Apparently, commenting the function below doesn't impact the performance
            setChatMessages(newChatMessages);

            const response = Chatbot.getResponse(inputText);

            // WATCH OUT! State is updated after all of the code is finished!
            // So this below overwrites the input message and displays the response at the end
            setChatMessages([
              ...newChatMessages,
              {
                message: response,
                sender: 'robot',
                id: crypto.randomUUID()
              }
            ]);

            setInputText('');
          }

          return (
              // It is good to go with <div> if there will be flexbox feature
              // That is mainly because there is a container needed for it
              <div
              className="chat-input-container">                
                  <input
                    type="text"
                    placeholder="Type your message..."
                    size="50"
                    onChange = {saveInputText}
                    value={inputText}   
                    className="chat-input"               
                  />
                  <button
                  onClick={sendMessage}
                  className="send-button"
                  > Send </button>
              </div>
          );
        }

        // chat message component
        function ChatMessage(props) {
          // console.log("ChatMessage props:", props);
          
          // const message = props.message;
          // const sender = props.sender;

          // OR alternatively
          // Even without the line below, message and sender can be destructed and passed directly in the function parameters like: { message, sender }
          const { message, sender } = props; // shortcut for props.message and props.sender

          /*
          if (sender === "user") {
            return (
              <div>
                {message}
                <img src={`images/user.jpg`} width="50" />
              </div>
            );
          }
          */

          return (
              <div className={sender === 'user' ? 'chat-message-user' : 'chat-message-robot'}>
                {sender === "robot" && <img src={`images/robot.jpg`} className='chat-message-image' />}
                <div className='chat-message-text'>
                  {message}
                </div>
                {sender === "user" && <img src={`images/user.jpg`} className='chat-message-image' />}
              </div>
          );
        
          
          // OR ALTERNATIVELY you can use conditional clauses to return
          // which seems more efficient and cleaner BUT images are positioned similary for both
          // return(
          //   // For reproducibility, no message should be passed directly below!
          //   <div>
          //     {message}
          //     <img src={`images/${sender}.jpg`} width="50" /> 
          //   </div>
          // )

        }

        // Elements to pass to the render below
        const button = <button>Click Me!</button>;
        const text = <p>This is a paragraph to be rendered with React.</p>;
        // What if we want to display multiple elements?
        const app = (
            // {ChatInput()} could be an alternative way to call the component NOT RECOMMENDED
            // Also variable like {button} and {text} could be used inside JSX
            // even all different tags could be used directly inside JSX
            <>
                <ChatInput></ChatInput>
                <ChatMessage message="Hello Chatbot!" sender="user" />
                <ChatMessage message="How can I help you?" sender="robot" />
                <ChatMessage message="Can you get me todays date?" sender="user" />
                <ChatMessage message="Today is September 21st." sender="robot" />  
            </>
        );


        function ChatMessages({ chatMessages }) {
      
          return(
            // Be careful that on click, the content of the array is updated bu not the DOM
            // so the updated content might be displayed on explorer
            // You’re changing the variable in memory, but the page doesn’t know it needs to update.
            // Unless your code listens for changes and updates the DOM (for example, by re-running a render function or setting state in React)
            <>

              {
                  chatMessages.map((chatMessage) => {
                    return(
                      <ChatMessage 
                        message={chatMessage.message}
                        sender={chatMessage.sender}
                        key={chatMessage.id}
                      />
                    )
                  })
                }
            </>
          )

        }

        // ALT for app (creating App component)
        // and use it instead of the variable 'app' above
        function App() {

          // Move state into App() so other components can access
          // const array = React.useState( 
          //   [{
          //   message: 'Hello Chatbot',
          //   sender: 'user',
          //   id: 'id1'
          // }, {
          //   message: 'Hello! How can I help you?',
          //   sender: 'robot',
          //   id: 'id2'
          // }, {
          //   message: 'Can you get me today\'s date?',
          //   sender: 'user',
          //   id: 'id3'
          // }, {
          //   message: 'Today is September 27th.',
          //   sender: 'robot',
          //   id: 'id4'
          // }]
          // );
          // 2. The array above re-organized through directly via array destructuring
          // instead of firstly forming 'array' and then destructuring it
          const [chatMessages, setChatMessages] = React.useState( 

            [{
            message: 'Hello Chatbot',
            sender: 'user',
            id: 'id1'
          }, {
            message: 'Hello! How can I help you?',
            sender: 'robot',
            id: 'id2'
          }, {
            message: 'Can you get me today\'s date?',
            sender: 'user',
            id: 'id3'
          }, {
            message: 'Today is September 27th.',
            sender: 'robot',
            id: 'id4'
          }]
          );
          // const chatMessages = array[0]; // current data
          // const setChatMessages = array[1]; // function to update data/DOM (Updater Function)
          // 1. ALTERNATIVE to the two lines above: array destructuring where order matters
          // const [chatMessages, setChatMessages] = array

          // const chatMessageComponents = chatMessages.map((chatMessage) => {
          //   return(
          //     <ChatMessage 
          //       message={chatMessage.message}
          //       sender={chatMessage.sender}
          //     />
          //   )
          // });

          return(
            <div
            className="app-container">
              <ChatInput
                chatMessages={chatMessages}
                setChatMessages={setChatMessages} />
              <ChatMessages 
                chatMessages={chatMessages}
              />
            </div>
          )
        }

        const container = document.querySelector('.js-container');
        ReactDOM.createRoot(container).render(<App />);
    </script>
  </body>
</html>